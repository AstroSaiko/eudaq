GET_FILENAME_COMPONENT(DIRNAME ${CMAKE_CURRENT_LIST_DIR} NAME)
SET(PLUGIN_NAME plugin.${DIRNAME})
SET_PROPERTY(GLOBAL APPEND PROPERTY CONVERTER_PLUGIN ${PLUGIN_NAME})

INCLUDE_DIRECTORIES(include)

SET(PLUGIN_SRC
  src/ProcessorManager.cc
  src/Processor.cc
  src/ExamplePS.cc
  src/EventSenderPS.cc
  src/EventReceiverPS.cc
  )

ADD_LIBRARY(${PLUGIN_NAME} SHARED ${PLUGIN_SRC})


INSTALL(TARGETS ${PLUGIN_NAME}
  RUNTIME DESTINATION bin
  LIBRARY DESTINATION lib
  ARCHIVE DESTINATION lib)



SET(PRODUCER_NAME "processortest")
SET(PRODUCER_SRC
  src/testmain.cxx
  )
ADD_EXECUTABLE(${PRODUCER_NAME} ${PRODUCER_SRC} )

TARGET_LINK_LIBRARIES(${PRODUCER_NAME} EUDAQ ${EUDAQ_THREADS_LIB} ${PLUGIN_NAME})

INSTALL(TARGETS ${PRODUCER_NAME}
  RUNTIME DESTINATION bin
  LIBRARY DESTINATION lib
  ARCHIVE DESTINATION lib)
