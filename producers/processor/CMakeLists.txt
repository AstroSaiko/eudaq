GET_FILENAME_COMPONENT(DIRNAME ${CMAKE_CURRENT_LIST_DIR} NAME)
SET(PLUGIN_NAME plugin.${DIRNAME})
SET_PROPERTY(GLOBAL APPEND PROPERTY CONVERTER_PLUGIN ${PLUGIN_NAME})

LIST(APPEND CMAKE_PREFIX_PATH $ENV{ROOTSYS})
FIND_PACKAGE(ROOT REQUIRED)
INCLUDE(${ROOT_USE_FILE})

SET(PLUGIN_ROOT psmanroot)
SET(PLUGIN_DICT ${PLUGIN_ROOT}_ROOT)
SET(PLUGIN_DICT_CXX ${CMAKE_CURRENT_BINARY_DIR}/${PLUGIN_DICT}.cxx)
SET(PLUGIN_DICT_PCM ${CMAKE_CURRENT_BINARY_DIR}/lib${PLUGIN_DICT}_rdict.pcm)
SET(PLUGIN_DICT_MAP ${CMAKE_CURRENT_BINARY_DIR}/lib${PLUGIN_DICT}.rootmap)

SET(PLUGIN_INC
  include/ProcessorManager.hh
  include/Processor.hh
  )
SET(PLUGIN_SRC
  src/ProcessorManager.cc
  src/Processor.cc
  )
SET(PS_PLUGIN_SRC
  src/EventFileReaderPS.cc
  src/EventSenderPS.cc
  src/EventReceiverPS.cc
  src/ExamplePS.cc
  )

INCLUDE_DIRECTORIES(include)
ADD_LIBRARY(${PLUGIN_NAME} SHARED ${PLUGIN_SRC})

SET(PS_PLUGIN_NAME plugin.exampleps)
# SET_PROPERTY(GLOBAL APPEND PROPERTY CONVERTER_PLUGIN ${PS_PLUGIN_NAME})
ADD_LIBRARY(${PS_PLUGIN_NAME} SHARED ${PS_PLUGIN_SRC})


ROOT_GENERATE_DICTIONARY(${PLUGIN_DICT} ${PLUGIN_INC} LINKDEF include/LinkDef.hh)
ADD_LIBRARY(${PLUGIN_ROOT} SHARED ${PLUGIN_DICT_CXX})
TARGET_LINK_LIBRARIES(${PLUGIN_ROOT} EUDAQ ${PS_PLUGIN_NAME})


SET(PRODUCER_NAME "processortest")
SET(PRODUCER_SRC
  src/testmain.cxx
  )
ADD_EXECUTABLE(${PRODUCER_NAME} ${PRODUCER_SRC})
TARGET_LINK_LIBRARIES(${PRODUCER_NAME} EUDAQ ${PS_PLUGIN_NAME})


INSTALL(TARGETS
  ${PLUGIN_NAME}
  ${PS_PLUGIN_NAME}
  ${PLUGIN_ROOT}
  ${PRODUCER_NAME}
  RUNTIME DESTINATION bin
  LIBRARY DESTINATION lib
  ARCHIVE DESTINATION lib)

INSTALL(FILES
  ${PLUGIN_DICT_PCM}
  ${PLUGIN_DICT_MAP}
  DESTINATION lib
  )
